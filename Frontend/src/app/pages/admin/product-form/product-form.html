<div class="form-wrapper">
  <h2>{{ esEdicion ? '✏️ Editar' : '➕ Crear Nuevo' }} Producto</h2>

  <form [formGroup]="form" (ngSubmit)="guardar()">
    
    <div class="form-row">
      <div class="form-group">
        <label>Nombre del Producto *</label>
        <input type="text" formControlName="nombre" placeholder="Ej: Placa de video NVIDIA">
        <small class="error" *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched">
          El nombre es obligatorio.
        </small>
      </div>

      <div class="form-group">
        <label>SKU (Código Interno) *</label>
        <input type="text" formControlName="sku" placeholder="Ej: ZAP-001">
        <small class="error" *ngIf="form.get('sku')?.invalid && form.get('sku')?.touched">
          El SKU es obligatorio.
        </small>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Precio ($) *</label>
        <input type="number" formControlName="precio">
        <small class="error" *ngIf="form.get('precio')?.invalid && form.get('precio')?.touched">
          El precio es obligatorio y debe ser mayor a 0.
        </small>
      </div>
      
      <div class="form-group">
        <label>Stock (Unidades) *</label>
        <input type="number" formControlName="stock">
        <small class="error" *ngIf="form.get('stock')?.invalid && form.get('stock')?.touched">
          El stock es obligatorio y no puede ser negativo.
        </small>
      </div>
    </div>

    <div class="form-group">
      <label>Categoría *</label>
      <select formControlName="idCategoria">
        <option [ngValue]="null">-- Selecciona una Categoría --</option>
        <option *ngFor="let cat of categorias" [value]="cat.idCategoria">
          {{ cat.nombre }}
        </option>
      </select>
      <small class="error" *ngIf="form.get('idCategoria')?.invalid && form.get('idCategoria')?.touched">
        Debes seleccionar una categoría.
      </small>
    </div>

    <div class="form-group">
      <label>URL de Imagen</label>
      <input type="text" formControlName="urlImagen" placeholder="http://...">
      <img *ngIf="form.get('urlImagen')?.value" 
           [src]="form.get('urlImagen')?.value" 
           class="preview-img"
           (error)="form.get('urlImagen')?.setValue(null)" 
           alt="Vista previa del producto">
    </div>

    <div class="form-group">
      <label>Descripción</label>
      <textarea formControlName="descripcion" rows="4"></textarea>
    </div>

    <div class="actions">
      <button type="button" class="btn-cancel" (click)="cancelar()">Cancelar</button>
      <button type="submit" class="btn-save" [disabled]="form.invalid">
        {{ esEdicion ? 'Guardar Cambios' : 'Crear Producto' }}
      </button>
    </div>

  </form>
</div>